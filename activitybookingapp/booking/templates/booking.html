{% extends "layout.html" %}
{% block head %}
    <title>Booking</title>
{% endblock %}

{% block content %}
    <div class='flex items-center justify-center px-20 py-28 '>
        <div class='p-10 rounded-3xl shadow-md w-[600px] bg-white'>
            {% if user.is_staff %}
                <div class='flex justify-between items-center mb-4'>
                    <h2 class="text-lg font-normal pb-2"><i class="fa-solid fa-address-card pr-1" style="color: #74C0FC;"></i>Student Infomation</h2>
                    {% if perms.booking.change_booking and booking.status != 'CANCELED' and booking.status != 'REJECTED' and booking.status != 'APPROVED' %}
                        <form action="{% url 'change-booking-status' booking.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="approve">
                            <button type="submit" class="text-sm p-2 rounded-lg text-green-500 border border-green-500 bg-green-100 hover:bg-green-400 hover:text-white duration-200">
                                <i class="fa-regular fa-circle-check"></i> Approve
                            </button>
                        </form>
                    {% endif %}
                </div>

                <div class="flex w-full py-2 border px-4 rounded-lg mb-6">
                    <div class='flex flex-col w-6/12'>
                        <div class="flex flex-col">
                            <p class="text-sm text-gray-500">Student</p>
                            <p class="text-base text-gray-900">{{booking.student}}</p> 
                        </div>
                        <div class="flex flex-col pt-2">
                            <p class="text-sm text-gray-500">Email</p>
                            <p class="text-base text-gray-900">{{booking.student.email}}</p> 
                        </div>
                    </div>
                    <div class='flex flex-col w-6/12'>
                        <div class="flex flex-col">
                            <p class="text-sm text-gray-500">Student ID</p>
                            <p class="text-base text-gray-900">{{booking.student.stu_card}}</p> 
                        </div>
                        <div class="flex flex-col pt-2">
                            <p class="text-sm text-gray-500">Faculty</p>
                            <p class="text-base text-gray-900">{{booking.student.get_faculty_full_name}}</p> 
                        </div>
                    </div>
                </div>
            {% endif %}

            
            <p class='text-lg font-normal'><i class="fa-solid fa-address-book pr-1" style="color: #74C0FC;"></i>Booking</p>
            <p class="text-[10px] text-gray-500 mt-1">{{booking}}</p>
            <div class="mt-4 p-3 flex flex-col gap-2 border rounded-lg">
                <div class="flex w-full px-2 rounded-lg mb-6">
                    <div class='flex flex-col w-6/12'>
                        <div class="flex flex-col">
                            <p class="text-sm text-gray-500">Place</p>
			                <p class="text-base text-gray-900">{{booking.place.name}}</p> 
                        </div>
                        <div class="flex flex-col pt-2">
                            <p class="text-sm text-gray-500">Date Boking</p>
			                <p class="text-base text-gray-900">{{booking.date|date:"d/m/Y"}}</p> 
                        </div>
                    </div>
                    <div class='flex flex-col w-6/12'>
                        <div class="flex flex-col">
                            <p class="text-sm text-gray-500">Start time</p>
			                <p class="text-base text-gray-900">{{booking.start_time|time:"H:i"}}</p>  
                        </div>
                        <div class="flex flex-col pt-2">
                            <p class="text-sm text-gray-500">End time</p>
			                <p class="text-base text-gray-900">{{booking.end_time|time:"H:i"}}</p> 
                        </div>
                    </div>
                </div>
                <div>
                    <p class="text-sm mt-3 text-gray-500">Student Card Booking</p>
                    <div class='grid grid-cols-2 mt-6 ml-8 gap-y-4'>
                        {% for i in bookingfile%}
                            <img class = 'w-52 h-40 border rounded-lg'src="{{i.image.url}}" alt="">
                        {%endfor%}
                    </div>
                </div>

                <p class='font-base mt-8     text-gray-400'>Place Description</p>
                <hr class='mb-2'>
                <div>
                    <p class="text-sm text-gray-500">Location</p>
                    <p class="text-sm text-gray-900">{{booking.place.location}}</p> 
                </div>

                <div>
                    <p class="text-sm text-gray-500">Description</p>
                    <p class="text-sm text-gray-900">{{booking.place.description}}</p> 
                    
                </div>

                <div>
                    <p class="text-sm text-gray-500">Staff</p>
                    {% for staff in booking.place.staff.all %}
                        <p class="text-sm text-gray-900">{{staff}}</p>
                    {% endfor %}                    
                </div>


                <div class='mt-3 flex flex-col gap-1'>
                        {% if perms.booking.delete_booking%}
                            {% if booking.status != 'CANCELED' and booking.status != 'REJECTED' and booking.status != 'APPROVED' %}                            
                                <div class='flex justify-end mt-4'>
                                    <button class='hover:bg-red-400 bg-red-500 text-white p-1  rounded-md text-[15px] w-full' onclick='deleteBooking({{booking.id}}, "{{csrf_token}}")' >Cancel</button>
                                </div>
                            {% endif %}
                                <a href="{% url 'mybooking' %}">
                                    <button  class='hover:bg-green-400 bg-green-500 text-white p-1  rounded-md text-[15px] w-full'>Back</button>
                                </a> 
                        {% else %}
                            {% if perms.booking.change_booking and booking.status != 'CANCELED' and booking.status != 'REJECTED' and booking.status != 'APPROVED' %}

                                <button onclick='deleteBooking({{booking.id}}, "{{csrf_token}}")'class="mt-10 text-sm p-2 rounded-lg text-red-500 border border-red-500 bg-red-100 hover:bg-red-400 hover:text-white duration-200">
                                    <i class="fa-regular fa-circle-xmark"></i> Reject
                                </button>     
                            {% endif %}
                        
                        {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}

{{ block.super }}
        function deleteBooking(booking_id, csrf_token) {

            fetch(`/booking/mybooking/${booking_id}/`, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": csrf_token,
                },
            })
            .then((response) => {
                if (response.ok) {
                    console.log("Item deleted successfully");
                    window.location.href = "{% url 'mybooking' %}";
                } else {
                    return response.json().then((data) => {
                        console.error("Failed to delete:", data);
                    });
                }
            })
            .catch((error) => console.error("Error:", error));
        }
{% endblock script %}

